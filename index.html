<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Co-do - AI File System Manager</title>
  <meta name="description" content="AI-powered file system manager using the File System Access API">

  <!-- Content Security Policy - allows connections to AI providers -->
  <!-- Note: frame-ancestors is omitted here because it's ignored in meta tags per CSP spec.
       It must be delivered via HTTP header (configured in vite.config.ts for dev, and at
       the hosting/CDN level for production). -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'; connect-src 'self' https://api.anthropic.com https://api.openai.com https://generativelanguage.googleapis.com; img-src 'self' data:; font-src 'self'; object-src 'none'; base-uri 'self'; form-action 'self'">

  <!-- PWA Configuration -->
  <link rel="manifest" href="/Co-do/manifest.json">
  <meta name="theme-color" content="#3b82f6">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Co-do">
  <link rel="apple-touch-icon" href="/Co-do/icon-192.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/Co-do/icon-192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="/Co-do/icon-512.png">
</head>
<body>
  <div id="app">
    <!-- Header with icon buttons -->
    <header class="app-header">
      <div class="header-content">
        <button id="mobile-menu-btn" class="icon-btn mobile-only" title="Toggle menu" aria-label="Toggle menu">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="3" y1="12" x2="21" y2="12"></line>
            <line x1="3" y1="6" x2="21" y2="6"></line>
            <line x1="3" y1="18" x2="21" y2="18"></line>
          </svg>
        </button>
        <div class="app-branding">
          <img src="/Co-do/icon.svg" alt="" class="app-icon" width="32" height="32">
          <h1 class="app-title">Co-do</h1>
        </div>
        <div class="header-actions">
          <button id="info-btn" class="icon-btn" title="About Co-do" aria-label="About Co-do">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="12" y1="16" x2="12" y2="12"></line>
              <line x1="12" y1="8" x2="12.01" y2="8"></line>
            </svg>
          </button>
          <button id="settings-btn" class="icon-btn" title="AI Provider" aria-label="AI Provider">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <!-- Antenna -->
              <line x1="12" y1="2" x2="12" y2="5"></line>
              <!-- Head -->
              <rect x="4" y="5" width="16" height="14" rx="2"></rect>
              <!-- Eyes -->
              <circle cx="9" cy="11" r="2"></circle>
              <circle cx="15" cy="11" r="2"></circle>
              <!-- Mouth -->
              <line x1="9" y1="16" x2="15" y2="16"></line>
            </svg>
          </button>
          <button id="tools-btn" class="icon-btn" title="Tool Permissions" aria-label="Tool Permissions">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path>
            </svg>
          </button>
        </div>
      </div>
    </header>

    <!-- Main Content Area -->
    <main class="main-content">
      <!-- Sidebar overlay for mobile -->
      <div id="sidebar-overlay" class="sidebar-overlay"></div>

      <!-- Sidebar for context -->
      <aside class="sidebar" id="sidebar">
        <div class="sidebar-section">
          <h3 class="sidebar-title">Workspace</h3>
          <button id="select-folder-btn" class="sidebar-btn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
            </svg>
            Select Folder
          </button>
          <div id="folder-info" class="folder-info"></div>
        </div>

        <div class="sidebar-section">
          <h3 class="sidebar-title">Files</h3>
          <div id="file-list" class="file-list"></div>
        </div>
      </aside>

      <!-- Chat Area -->
      <div class="chat-area">
        <div id="chat-container" class="chat-container">
          <div id="messages" class="messages"></div>
        </div>

        <div class="chat-input-wrapper">
          <div id="status" class="status-bar"></div>
          <div class="chat-input-container">
            <textarea
              id="prompt-input"
              class="chat-input"
              placeholder="Ask me to help with your files..."
              rows="1"
              aria-label="Chat message input"
            ></textarea>
            <button id="send-btn" class="send-btn" aria-label="Send message">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="22" y1="2" x2="11" y2="13"></line>
                <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
              </svg>
            </button>
          </div>
          <div class="chat-privacy-notice">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="12" y1="16" x2="12" y2="12"></line>
              <line x1="12" y1="8" x2="12.01" y2="8"></line>
            </svg>
            <span>File contents are sent to your selected AI provider</span>
          </div>
        </div>
      </div>
    </main>

    <!-- Settings Modal -->
    <dialog id="settings-modal" class="modal" aria-labelledby="settings-modal-title">
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="settings-modal-title">AI Provider Settings</h2>
          <button class="modal-close" aria-label="Close">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>
        <div class="modal-body">
          <div class="providers-section">
            <div class="providers-header">
              <h3>Your Providers</h3>
              <button id="add-provider-btn" class="primary-btn">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="12" y1="5" x2="12" y2="19"></line>
                  <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
                Add Provider
              </button>
            </div>
            <div id="providers-list" class="providers-list">
              <!-- Populated dynamically -->
            </div>
          </div>
        </div>
      </div>
    </dialog>

    <!-- Add/Edit Provider Modal -->
    <dialog id="provider-edit-modal" class="modal" aria-labelledby="provider-edit-modal-title">
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="provider-edit-modal-title">Add Provider</h2>
          <button class="modal-close" aria-label="Close">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label for="provider-name">Configuration Name</label>
            <input type="text" id="provider-name" class="form-input" placeholder="e.g., My Claude Config" autocomplete="off">
            <small class="form-hint">Give this configuration a memorable name</small>
          </div>

          <div class="form-group">
            <label for="provider-type">AI Provider</label>
            <select id="provider-type" class="form-select">
              <option value="anthropic">Anthropic (Claude)</option>
              <option value="openai">OpenAI (GPT)</option>
              <option value="google">Google (Gemini)</option>
            </select>
          </div>

          <div class="form-group">
            <label for="provider-api-key">API Key</label>
            <input type="password" id="provider-api-key" class="form-input" placeholder="Enter your API key" autocomplete="off">
            <small class="form-hint">Your API key is stored locally in IndexedDB. <a id="provider-api-key-link" href="https://console.anthropic.com/settings/keys" target="_blank" rel="noopener noreferrer">Get API key</a></small>
          </div>

          <div class="form-group">
            <label for="provider-model">Model</label>
            <select id="provider-model" class="form-select">
              <!-- Populated dynamically based on provider -->
            </select>
          </div>

          <div class="form-group">
            <label class="checkbox-label" for="provider-is-default">
              <input type="checkbox" id="provider-is-default" class="form-checkbox">
              <span>Set as default provider</span>
            </label>
          </div>

          <div class="modal-buttons">
            <button id="provider-cancel-btn" class="secondary-btn">Cancel</button>
            <button id="provider-save-btn" class="primary-btn">Save</button>
          </div>
        </div>
      </div>
    </dialog>

    <!-- Tool Permissions Modal -->
    <dialog id="tools-modal" class="modal" aria-labelledby="tools-modal-title">
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="tools-modal-title">Tool Permissions</h2>
          <button class="modal-close" aria-label="Close">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>
        <div class="modal-body">
          <div id="tool-permissions" class="tool-permissions">
            <div class="permission-item">
              <span class="tool-name">Open File</span>
              <select class="permission-select" data-tool="open_file">
                <option value="always">Always Allow</option>
                <option value="ask" selected>Ask Each Time</option>
                <option value="never">Never Allow</option>
              </select>
            </div>
            <div class="permission-item">
              <span class="tool-name">Rename File</span>
              <select class="permission-select" data-tool="rename_file">
                <option value="always">Always Allow</option>
                <option value="ask" selected>Ask Each Time</option>
                <option value="never">Never Allow</option>
              </select>
            </div>
            <div class="permission-item">
              <span class="tool-name">Move File</span>
              <select class="permission-select" data-tool="move_file">
                <option value="always">Always Allow</option>
                <option value="ask" selected>Ask Each Time</option>
                <option value="never">Never Allow</option>
              </select>
            </div>
            <div class="permission-item">
              <span class="tool-name">Delete File</span>
              <select class="permission-select" data-tool="delete_file">
                <option value="always">Always Allow</option>
                <option value="ask" selected>Ask Each Time</option>
                <option value="never">Never Allow</option>
              </select>
            </div>
            <div class="permission-item">
              <span class="tool-name">Create File</span>
              <select class="permission-select" data-tool="create_file">
                <option value="always">Always Allow</option>
                <option value="ask" selected>Ask Each Time</option>
                <option value="never">Never Allow</option>
              </select>
            </div>
            <div class="permission-item">
              <span class="tool-name">Write File</span>
              <select class="permission-select" data-tool="write_file">
                <option value="always">Always Allow</option>
                <option value="ask" selected>Ask Each Time</option>
                <option value="never">Never Allow</option>
              </select>
            </div>
            <div class="permission-item">
              <span class="tool-name">List Files</span>
              <select class="permission-select" data-tool="list_files">
                <option value="always">Always Allow</option>
                <option value="ask" selected>Ask Each Time</option>
                <option value="never">Never Allow</option>
              </select>
            </div>
            <div class="permission-item">
              <span class="tool-name">Get File Metadata</span>
              <select class="permission-select" data-tool="get_file_metadata">
                <option value="always">Always Allow</option>
                <option value="ask" selected>Ask Each Time</option>
                <option value="never">Never Allow</option>
              </select>
            </div>
            <div class="permission-item">
              <span class="tool-name">Cat (Display File)</span>
              <select class="permission-select" data-tool="cat">
                <option value="always">Always Allow</option>
                <option value="ask" selected>Ask Each Time</option>
                <option value="never">Never Allow</option>
              </select>
            </div>
            <div class="permission-item">
              <span class="tool-name">Grep (Search Files)</span>
              <select class="permission-select" data-tool="grep">
                <option value="always">Always Allow</option>
                <option value="ask" selected>Ask Each Time</option>
                <option value="never">Never Allow</option>
              </select>
            </div>
            <div class="permission-item">
              <span class="tool-name">Head (First Lines)</span>
              <select class="permission-select" data-tool="head_file">
                <option value="always">Always Allow</option>
                <option value="ask" selected>Ask Each Time</option>
                <option value="never">Never Allow</option>
              </select>
            </div>
            <div class="permission-item">
              <span class="tool-name">Tail (Last Lines)</span>
              <select class="permission-select" data-tool="tail_file">
                <option value="always">Always Allow</option>
                <option value="ask" selected>Ask Each Time</option>
                <option value="never">Never Allow</option>
              </select>
            </div>
          </div>
        </div>
      </div>
    </dialog>

    <!-- Info Modal -->
    <dialog id="info-modal" class="modal" aria-labelledby="info-modal-title">
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="info-modal-title">About Co-do</h2>
          <button class="modal-close" aria-label="Close">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>
        <div class="modal-body">
          <div class="info-content">
            <h3>About This Project</h3>
            <p>
              Co-do was inspired by <a href="https://claude.com/blog/cowork-research-preview" target="_blank" rel="noopener noreferrer">Cowork by Anthropic</a>.
              I wanted to explore the possibilities of file manipulation directly in the browser using modern web APIs.
            </p>

            <h3>How It Works</h3>
            <p>
              Chrome (and other Chromium-based browsers) provide the <strong>File System Access API</strong>, which allows web applications
              to read and modify files on your local file system. This powerful feature is carefully sandboxedâ€”access is limited
              to only the directory you explicitly select, with no way to escape that sandbox (in theory).
            </p>

            <h3>Important Warnings</h3>
            <div class="warning-box">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                <line x1="12" y1="9" x2="12" y2="13"></line>
                <line x1="12" y1="17" x2="12.01" y2="17"></line>
              </svg>
              <div>
                <strong>This application modifies files AND shares data with AI providers.</strong>
                <p>
                  <strong>File Modifications:</strong> While sandboxed to your selected directory, this tool uses AI to make real changes to your files.
                  Always work on files you have backed up, and carefully review any changes the AI suggests before approving them.
                </p>
                <p>
                  <strong>Data Sharing:</strong> The contents of your files are sent to third-party AI providers (Anthropic, OpenAI, or Google) for processing.
                  Your data leaves your computer and is transmitted over the internet. Do not use this tool with sensitive, confidential, or proprietary information.
                </p>
                <p>
                  <strong>Use at your own risk.</strong>
                </p>
              </div>
            </div>

            <h3>Security & Privacy</h3>
            <ul>
              <li>Your API keys are stored locally in your browser and never sent anywhere except to your selected AI provider</li>
              <li>File operations are sandboxed to your selected directory</li>
              <li>You control which operations the AI can perform through tool permissions</li>
              <li>All file modifications require your explicit permission (configurable)</li>
            </ul>
          </div>
        </div>
      </div>
    </dialog>

    <!-- Data Sharing Warning Modal -->
    <!-- Note: This modal intentionally omits a close (X) button to ensure users explicitly acknowledge or cancel the warning -->
    <dialog id="data-share-modal" class="modal no-escape" aria-labelledby="data-share-modal-title">
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="data-share-modal-title">Important: Data Sharing Notice</h2>
          <!-- Close button intentionally omitted - users must explicitly choose Cancel or Accept -->
        </div>
        <div class="modal-body">
          <div class="info-content">
            <div class="warning-box critical">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                <line x1="12" y1="9" x2="12" y2="13"></line>
                <line x1="12" y1="17" x2="12.01" y2="17"></line>
              </svg>
              <div>
                <strong>Your file contents will be sent to a third-party AI provider</strong>
                <p>
                  When you select a folder and interact with Co-do, the contents of your files will be transmitted to your chosen AI provider (Anthropic, OpenAI, or Google) for processing.
                </p>
                <ul>
                  <li><strong>Your data leaves your computer:</strong> File contents are sent over the internet to the AI provider's servers</li>
                  <li><strong>Privacy considerations:</strong> Do not use this tool with sensitive, confidential, or proprietary files</li>
                  <li><strong>Third-party terms apply:</strong> Your data is subject to the AI provider's terms of service and privacy policy</li>
                  <li><strong>Use at your own risk:</strong> You are responsible for ensuring you have the right to share any files you work with</li>
                </ul>
                <p class="warning-emphasis">
                  <strong>Only proceed if you understand and accept these risks.</strong>
                </p>
              </div>
            </div>

            <div class="modal-buttons">
              <button id="data-share-cancel" class="secondary-btn">Cancel</button>
              <button id="data-share-accept" class="primary-btn">I Understand, Continue</button>
            </div>
          </div>
        </div>
      </div>
    </dialog>
  </div>

  <!-- Update Notification -->
  <div id="update-notification" class="update-notification" role="alert" aria-live="polite" hidden>
    <span class="update-notification-text">A new version is available</span>
    <a id="update-changelog-link" class="update-notification-link" target="_blank" rel="noopener noreferrer" hidden>
      What's new?
    </a>
    <button id="update-reload-btn" class="update-notification-btn">Reload</button>
    <button id="update-dismiss-btn" class="update-notification-dismiss" aria-label="Dismiss">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>
  </div>

  <!-- Toast Notifications Container -->
  <div id="toast-container" class="toast-container" role="region" aria-label="Notifications"></div>

  <script type="module" src="/src/main.ts"></script>
</body>
</html>
