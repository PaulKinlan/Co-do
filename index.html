<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Co-do - AI File System Manager</title>
  <meta name="description" content="AI-powered file system manager using the File System Access API">
</head>
<body>
  <div id="app">
    <!-- Header with icon buttons -->
    <header class="app-header">
      <div class="header-content">
        <button id="mobile-menu-btn" class="icon-btn mobile-only" title="Toggle menu" aria-label="Toggle menu">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="3" y1="12" x2="21" y2="12"></line>
            <line x1="3" y1="6" x2="21" y2="6"></line>
            <line x1="3" y1="18" x2="21" y2="18"></line>
          </svg>
        </button>
        <h1 class="app-title">Co-do</h1>
        <div class="header-actions">
          <button id="info-btn" class="icon-btn" title="About Co-do" aria-label="About Co-do">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="12" y1="16" x2="12" y2="12"></line>
              <line x1="12" y1="8" x2="12.01" y2="8"></line>
            </svg>
          </button>
          <button id="settings-btn" class="icon-btn" title="Settings" aria-label="Settings">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path>
              <circle cx="12" cy="12" r="3"></circle>
            </svg>
          </button>
          <button id="tools-btn" class="icon-btn" title="Tool Permissions" aria-label="Tool Permissions">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path>
            </svg>
          </button>
        </div>
      </div>
    </header>

    <!-- Main Content Area -->
    <main class="main-content">
      <!-- Sidebar overlay for mobile -->
      <div id="sidebar-overlay" class="sidebar-overlay"></div>

      <!-- Sidebar for context -->
      <aside class="sidebar" id="sidebar">
        <div class="sidebar-section">
          <h3 class="sidebar-title">Workspace</h3>
          <button id="select-folder-btn" class="sidebar-btn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
            </svg>
            Select Folder
          </button>
          <div id="folder-info" class="folder-info"></div>
        </div>

        <div class="sidebar-section">
          <h3 class="sidebar-title">Files</h3>
          <div id="file-list" class="file-list"></div>
        </div>
      </aside>

      <!-- Chat Area -->
      <div class="chat-area">
        <div id="chat-container" class="chat-container">
          <div id="messages" class="messages"></div>
        </div>

        <div class="chat-input-wrapper">
          <div id="status" class="status-bar"></div>
          <div class="chat-input-container">
            <textarea
              id="prompt-input"
              class="chat-input"
              placeholder="Ask me to help with your files..."
              rows="1"
              aria-label="Chat message input"
            ></textarea>
            <button id="send-btn" class="send-btn" aria-label="Send message">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="22" y1="2" x2="11" y2="13"></line>
                <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
              </svg>
            </button>
          </div>
        </div>
      </div>
    </main>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal" hidden role="dialog" aria-modal="true" aria-labelledby="settings-modal-title">
      <div class="modal-overlay"></div>
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="settings-modal-title">Settings</h2>
          <button class="modal-close" aria-label="Close">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label for="ai-provider">AI Provider</label>
            <select id="ai-provider" class="form-select">
              <option value="anthropic">Anthropic (Claude)</option>
              <option value="openai">OpenAI (GPT)</option>
              <option value="google">Google (Gemini)</option>
            </select>
          </div>

          <div class="form-group">
            <label for="api-key">API Key</label>
            <input type="password" id="api-key" class="form-input" placeholder="Enter your API key" autocomplete="off">
            <small class="form-hint">Your API key is stored locally and never sent anywhere except the selected AI provider. <a id="api-key-link" href="https://console.anthropic.com/settings/keys" target="_blank" rel="noopener noreferrer">Get API key</a></small>
          </div>

          <div class="form-group">
            <label for="model">Model</label>
            <select id="model" class="form-select">
              <!-- Populated dynamically based on provider -->
            </select>
          </div>
        </div>
      </div>
    </div>

    <!-- Tool Permissions Modal -->
    <div id="tools-modal" class="modal" hidden role="dialog" aria-modal="true" aria-labelledby="tools-modal-title">
      <div class="modal-overlay"></div>
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="tools-modal-title">Tool Permissions</h2>
          <button class="modal-close" aria-label="Close">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>
        <div class="modal-body">
          <div id="tool-permissions" class="tool-permissions">
            <div class="permission-item">
              <span class="tool-name">Open File</span>
              <select class="permission-select" data-tool="open_file">
                <option value="always">Always Allow</option>
                <option value="ask" selected>Ask Each Time</option>
                <option value="never">Never Allow</option>
              </select>
            </div>
            <div class="permission-item">
              <span class="tool-name">Rename File</span>
              <select class="permission-select" data-tool="rename_file">
                <option value="always">Always Allow</option>
                <option value="ask" selected>Ask Each Time</option>
                <option value="never">Never Allow</option>
              </select>
            </div>
            <div class="permission-item">
              <span class="tool-name">Move File</span>
              <select class="permission-select" data-tool="move_file">
                <option value="always">Always Allow</option>
                <option value="ask" selected>Ask Each Time</option>
                <option value="never">Never Allow</option>
              </select>
            </div>
            <div class="permission-item">
              <span class="tool-name">Delete File</span>
              <select class="permission-select" data-tool="delete_file">
                <option value="always">Always Allow</option>
                <option value="ask" selected>Ask Each Time</option>
                <option value="never">Never Allow</option>
              </select>
            </div>
            <div class="permission-item">
              <span class="tool-name">Create File</span>
              <select class="permission-select" data-tool="create_file">
                <option value="always">Always Allow</option>
                <option value="ask" selected>Ask Each Time</option>
                <option value="never">Never Allow</option>
              </select>
            </div>
            <div class="permission-item">
              <span class="tool-name">Write File</span>
              <select class="permission-select" data-tool="write_file">
                <option value="always">Always Allow</option>
                <option value="ask" selected>Ask Each Time</option>
                <option value="never">Never Allow</option>
              </select>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Info Modal -->
    <div id="info-modal" class="modal" hidden role="dialog" aria-modal="true" aria-labelledby="info-modal-title">
      <div class="modal-overlay"></div>
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="info-modal-title">About Co-do</h2>
          <button class="modal-close" aria-label="Close">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>
        <div class="modal-body">
          <div class="info-content">
            <h3>About This Project</h3>
            <p>
              Co-do was inspired by <a href="https://www.anthropic.com/news/cowork" target="_blank" rel="noopener noreferrer">Cowork by Anthropic</a>.
              I wanted to explore the possibilities of file manipulation directly in the browser using modern web APIs.
            </p>

            <h3>How It Works</h3>
            <p>
              Chrome (and other Chromium-based browsers) provide the <strong>File System Access API</strong>, which allows web applications
              to read and modify files on your local file system. This powerful feature is carefully sandboxedâ€”access is limited
              to only the directory you explicitly select, with no way to escape that sandbox (in theory).
            </p>

            <h3>Important Warning</h3>
            <div class="warning-box">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                <line x1="12" y1="9" x2="12" y2="13"></line>
                <line x1="12" y1="17" x2="12.01" y2="17"></line>
              </svg>
              <div>
                <strong>This application modifies files on your file system.</strong>
                <p>
                  While sandboxed to your selected directory, this tool uses AI to make real changes to your files.
                  Always work on files you have backed up, and carefully review any changes the AI suggests before approving them.
                  Use at your own risk.
                </p>
              </div>
            </div>

            <h3>Security & Privacy</h3>
            <ul>
              <li>Your API keys are stored locally in your browser and never sent anywhere except to your selected AI provider</li>
              <li>File operations are sandboxed to your selected directory</li>
              <li>You control which operations the AI can perform through tool permissions</li>
              <li>All file modifications require your explicit permission (configurable)</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script type="module" src="/src/main.ts"></script>
</body>
</html>
